<!DOCTYPE html>
<html>

  <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
 
    <div class="logo">
      <img src="botlogo.png" />
    </div> 


  <ul>
    <li><a href="task.html" class="active">Tasks</a></li>
    <li><a href="proxies.html" class="active">Proxies</a></li>
    <li><a href="profiles.html" class="active">Profiles</a></li>
    <li><a href="taskbuilder.html" class="active">Task Builder</a></li>
    <li><a href="settings.html" class="active">Settings</a></li>
  </ul>

  <p> 
   Profiles Page 
   <br />
  </p>


  <p>Personal/Shipping Info</p>
<form>
  <script>
    let test = "";
    function getProfInfo(selectedProf) {
      var rawFile = new XMLHttpRequest();
      var allText = "";
      rawFile.open("GET", "./profiles/" + selectedProf + ".pf", false);
      rawFile.onreadystatechange = function() {
        if (rawFile.readyState === 4) {
          if (rawFile.status === 200 || rawFile.status == 0) {
            allText = rawFile.responseText;
          }
        }
      }
      rawFile.send(null);
      return allText.split("\n");
    }

    function onClickEdit() {
      var profList = document.getElementById('profList');
      var selectedProf = profList.value;
      console.log(profList.value);
      let rawSplitData = getProfInfo(selectedProf);
      
      console.log(rawSplitData[0], "...fuck");
      document.getElementById('profName').value = selectedProf;
      document.getElementById('name').value = rawSplitData[0];
      document.getElementById('email').value = rawSplitData[1];
      document.getElementById('phone-number').value = rawSplitData[2];
      document.getElementById('address').value = rawSplitData[3]
      document.getElementById('zip').value = rawSplitData[4];
      document.getElementById('city').value = rawSplitData[5];
      document.getElementById('state').value = rawSplitData[6];
      document.getElementById('card').value = rawSplitData[7];

      let dumbLoserCodeVariable = dumbLoserCodeFunction(rawSplitData[8]);
      document.getElementById('expDate').value = dumbLoserCodeVariable;
      dumbLoserCodeVariable = dumbLoserCodeFunction(rawSplitData[9]);
      document.getElementById('expYear').value = dumbLoserCodeVariable;
      document.getElementById('cardCvv').value = rawSplitData[10];
    }

    function dumbLoserCodeFunction(dumb) {
      if (dumb == 1) return "0" + 1;
      if (dumb == 2) return "0" + 2;
      if (dumb == 3) return "0" + 3;
      if (dumb == 4) return "0" + 4;
      if (dumb == 5) return "0" + 5;
      if (dumb == 6) return "0" + 6;
      if (dumb == 7) return "0" + 7;
      if (dumb == 8) return "0" + 8;
      if (dumb == 9) return "0" + 9;
      if (dumb == 10) return "" + 10;
      if (dumb == 11) return "" + 11;
      if (dumb == 12) return "" + 12;
      if (dumb == 2020) return "" + 2020;
      if (dumb == 2021) return "" + 2021;
      if (dumb == 2022) return "" + 2022;
      if (dumb == 2023) return "" + 2023;
      if (dumb == 2024) return "" + 2024;
      if (dumb == 2025) return "" + 2025;
      if (dumb == 2026) return "" + 2026;
    }

    function refreshProfileList() {
      var tempStr = "";
      var fs = require('fs');
      const profDir = './profiles/';;

      fs.readdir(profDir, (err, files) => {
        files.forEach(file => {
          tempStr += file.toString() + " ";
        });
        var profArray = tempStr.split(".pf ");
        var profList = document.getElementById("profList");
        var defaultOpt = document.createElement("option");
        defaultOpt.value = "000";
        defaultOpt.text = "Select profile...";
        profList.add(defaultOpt); 
        profArray.forEach(temp => {
          if (temp != "") {
            var tempOpt = document.createElement("option");
            tempOpt.value = temp;
            tempOpt.text = temp;
            profList.add(tempOpt);
          }
        });
      });
    }
    function onClickSave() {
      var fs = require('fs');
      console.log("Test");
      fs.open("profiles/" + document.getElementById("profName").value + ".pf", 'w', function(err, file) {
        if (err) throw err;
      });
      fs.writeFile("profiles/" + document.getElementById("profName").value + ".pf", 
      document.getElementById("name").value + "\n" +
      document.getElementById("email").value + "\n" +
      document.getElementById("phone-number").value + "\n" +
      document.getElementById("address").value + "\n" +
      document.getElementById("zip").value + "\n" +
      document.getElementById("city").value + "\n" +
      document.getElementById("state").value + "\n" + 
      document.getElementById("card").value + "\n" +
      document.getElementById("expDate").value + "\n" +
      document.getElementById("expYear").value + "\n" +
      document.getElementById("cardCvv").value + "\n", function (err) {
        if (err) throw err;
        console.log("File saved!");
      });
      refreshProfileList();
    }
    refreshProfileList();
  </script>  
  <div class="group" style="position:absolute;left:500px">
    <label>Edit Existing Profile<br /></label>
    <select name="Profiles" id="profList"></select>
    <button name="btnEdit" type="button" id="btnEditProfile" onclick="onClickEdit()">Edit Profile</button>
  </div>
  <div class="group">
    <label>Profile Name*<br /></label>
    <input spellcheck="false" id="profName" type="text" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>
  <div class="group">
    <label>Name*<br /></label>
    <input spellcheck="false" id="name" type="text" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>

  <div class="group">
    <label>Email*<br /></label>
    <input spellcheck="false" id="email" type="text" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>

  <div class="group">
    <label>Phone Number*<br /></label>
    <input spellcheck="false" id="phone-number" type="text" required>
    <span class="highlight"></span>
    <span class="bar"></span> 
  </div>

  <div class="group">
    <label>Address*<br /></label>
    <input spellcheck="false" id="address" type="text" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>

  <div class="group">
    <label>Zip Code*<br /></label>
    <input spellcheck="false" id="zip" type="text" maxlength="5" size="5" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>

  <div class="group">
    <label>City*<br /></label>
    <input spellcheck="false" id="city" type="text" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>

  <div class="group">
    <label>State*<br /></label>
    <input spellcheck="false" id="state" type="text" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>

  <p>Billing Info</p>
  
  <div class="group">
    <label>Card Number*<br /></label>
    <input spellcheck="false" id="card" type="text" maxlength= "19" size="19" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>

  <label>Expiration Date<br /></label>

  <select name = Expiration Date id='expDate'>
    <option value = "01">01</option>
    <option value = "02">02</option>
    <option value = "03">03</option>
    <option value = "04">04</option>
    <option value = "05">05</option>
    <option value = "06">06</option>
    <option value = "07">07</option>
    <option value = "08">08</option>
    <option value = "09">09</option>
    <option value = "10">10</option>
    <option value = "11">11</option>
    <option value = "12">12</option>
  </select>

  <select name = 'Expiration Year' id='expYear'>
    <option value = '2020'>2020</option>
    <option value = '2021'>2021</option>
    <option value = '2022'>2022</option>
    <option value = '2023'>2023</option>
    <option value = '2024'>2024</option>
    <option value = '2025'>2025</option>
    <option value = '2026'>2026</option>
  </select>

  <div class="group">
    <label>CVV*<br /></label>
    <input spellcheck="false" id="cardCvv" type="text" maxlength="3" size="3" required>
    <span class="highlight"></span>
    <span class="bar"></span>
  </div>
  <button type="submit" id="submitButton" onclick="onClickSave();">Save Changes</button>
</form>

  </body>
</html>
